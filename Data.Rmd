Нами были выбраны данные [31 волны](https://www.hse.ru/rlms/news/856261114.html) Российского мониторинга экономического положения и здоровья населения НИУ ВШЭ.

Подгружаем данные:

```{r}
library(haven)
library(dplyr)

dataset = as.data.frame(read_sav('r31iall_61_2.sav'))
```

#### Целевая переменная

Сколько часов в среднем продолжается Ваша обычная рабочая неделя? (aaj6.2)

```{r}
workweek <- dataset['aaj6.2'] 
hist(workweek[workweek < 9999997], 50)
```

## Регрессоры

#### Про саму работу

\- В какой отрасли Вы работаете на этой работе? (aaj4.1). *Категориальная переменная*

\- За последние 12 месяцев какова была Ваша среднемесячная зарплата на этом предприятии после вычета налогов - независимо от того, платят Вам ее вовремя или нет? (aaj13.2)

\- Является ли производство, на котором Вы работаете, вредным или опасным, т.е. дающим Вам право на досрочное назначение трудовой пенсии, на дополнительные выплаты или льготы? (aaj21.3). *Категориальная переменная*

\- Вы пользовались Интернетом в течение последних 12 месяцев для работы? (как индикатор интеллектуального труда) (aaj125.2). *Категориальная переменная*

#### Про человека

\- Пол респондента (aah5). *Категориальная переменная*

\- Количество полных лет (aa_age)

\- ОБРАЗОВАНИЕ (ПОДРОБНО): старше 14 лет - 31 ВОЛНА (aa_educ). *Категориальная переменная*

\- Сколько полных лет и месяцев составляет Ваш официально оформленный общий трудовой стаж, не считая времени учебы на дневном отделении ВУЗа или техникума? (лет) (aaj161.3y)

#### Индикаторы высокой должности

\- У Вас есть подчиненные на этой работе? (aaj6). *Категориальная переменная*

\- Сколько у Вас подчиненных? Пожалуйста, посчитайте всех Ваших подчиненных, а не только тех, кто находится в Вашем непосредственном подчинении (aaj6.0)

#### Описание организации

\- На этой работе Вы работаете на предприятии, в организации? Мы имеем в виду любую организацию, в которой работает более одного человека, независимо от того, частная она или государственная (aaj11). *Категориальная переменная*

\- Вы оформлены на этой работе официально, то есть по трудовой книжке, трудовому соглашению, контракту? (aaj11.1). *Категориальная переменная*

\- Сколько человек работает на Вашем предприятии? Если не знаете точно, скажите примерно (aaj13)

\- Является государство владельцем или совладельцем Вашего предприятия, организации? (aaj23). *Категориальная переменная*

\- А Вы лично являетесь владельцем или совладельцем предприятия, на котором Вы работаете? (aaj26). *Категориальная переменная*

## Пропущенная переменная: мотивация работать

### Мотивация как страх потерять работу

-   У Вас есть дети, родные или официально усыновленные? (aaj72.171). *Категориальная переменная*
-   Насколько Вас беспокоит то, что Вы можете потерять работу? (aaj31). *Категориальная переменная*

### Мотивация повышения/сохранения уровня жизни

-   Насколько Вы удовлетворены своим материальным положением в настоящее время?? (aaj66.1). *Категориальная переменная*
-   Представьте себе лестницу из 9 ступеней, где на нижней, первой ступени, стоят нищие, а на высшей, девятой - богатые. На какой из девяти ступеней находитесь сегодня Вы лично? (aaj62). *Категориальная переменная*
-   Насколько Вас беспокоит то, что Вы не сможете обеспечивать себя самым необходимым в ближайшие 12 месяцев? (aaj66). *Категориальная переменная*
-   Как Вы думаете, через 12 месяцев Вы и Ваша семья будете жить лучше или хуже, чем сегодня? (aaj61). *Категориальная переменная*

### Отсутствие мотивации

-   В настоящее время Ваше предприятие осталось должно Вам какие-то деньги, которые по разным причинам не выплатило вовремя? (aaj14). *Категориальная переменная*
-   Сколько всего денег Вам не доплатили? (aaj15)
-   За сколько месяцев предприятие не доплатило Вам эти деньги? (aaj16)
-   Хотели бы Вы найти (другую) работу? (aaj81). *Категориальная переменная*

# Обработка таблицы

Сначала выберем перечисленные выше переменные из общего датафрейма:

```{r}
df <- dataset[,
              c('aaj6.2',
                'aaj4.1', 'aaj13.2', 'aaj21.3', 'aaj125.2',
                'aah5', 'aa_age', 'aa_educ', 'aaj161.3y',
                'aaj6', 'aaj6.0',
                'aaj11', 'aaj11.1', 'aaj13', 'aaj23', 'aaj26',
               
                # оценки пропущенной переменной
                'aaj72.171', 'aaj31', 
                'aaj66.1', 'aaj62', 'aaj66', 'aaj61',
                'aaj14', 'aaj15', 'aaj16', 'aaj81'
               )]
```

Уберём все строки, где пропущена целевая переменная:

```{r}
df <- df %>%
  filter(!is.na(aaj6.2))
```

В датафрейме много пропусков, особенно в столбцах с вопросами про задержанную зарплату. По смыслу на месте пропусков должны быть нули – если работодатель нисколько не должен и нисколько месяцев, то там будет ноль.

```{r}
df[c('aaj15', 'aaj16')][is.na(df[c('aaj15', 'aaj16')])] <- 0
```

Аналогично этому, если у человека нет подчинённых, то в вопросе о том, сколько их, стоит пропуск, а по смыслу должен быть ноль:

```{r}
df[(df$aaj6 == 2) & is.na(df$aaj6.0), 'aaj6.0'] <- 0
```

Очистим от оставшихся пропусков:

```{r}
df <- na.omit(df)
```

Нужно почистить датафрейм от неинформативных ответов по типу "Затрудняюсь ответить", "Отказ от ответа", "Нет ответа" и т.п. Они обозначены значениями более 99999995, значит, нужен срез по значениям меньше данного.

```{r}
badObs <- c()

for (j in 1:ncol(df)){
  badObs <- c(badObs, which(df[,j] > 99999995))
}
badObs <- unique(badObs)

df <- df[-badObs, ]
```

Обработаем категориальные переменные

```{r}
cat_names = c('aaj4.1', 'aaj21.3', 'aaj125.2', 'aah5', 'aa_educ', 'aaj6', 'aaj11', 'aaj11.1', 'aaj23', 'aaj26', 'aaj72.171', 'aaj31', 'aaj66.1', 'aaj62', 'aaj66', 'aaj61', 'aaj14', 'aaj81')
df[cat_names] <- lapply(df[cat_names], as.factor)
```

Экспортируем данные в .csv файл:

```{r}
write.csv(df, 'workinghours_df.csv', row.names = FALSE)
```
